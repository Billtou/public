substitutions:
  #################################################### 定義頁面名稱，義下可修改增減
  SCREEN_MAIN: main
  SCREEN_ROOMS: rooms
  SCREEN_KITCHEN: kitchen
  SCREEN_FAVORITE: favorite
  SCREEN_MEDIA: media
  SCREEN_LIVCLIMATE: livclimate
  SCREEN_CURTAIN: curtain
###################################################### 定義頁面名稱，以上可修改增減

esphome:
  name: "dashboard-one-3d68"  # 亂改會死機
  friendly_name: "dashboard-one-3d68"  # ""內的文字可以改成，例如 "Livingroom Dashboard"
  platformio_options:
    board_upload.maximum_ram_size: 327680
    board_upload.maximum_size: 16777216
    board_build.partitions: "/config/esphome/custom_partitions_3584.csv" 
    board_build.arduino.memory_type: qio_opi

esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: arduino
  flash_size: 16MB

logger:

api:

ota:

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

external_components:
  - source:
      type: local
      path: my_components

web_server:
  port: 80

time:
  - platform: sntp  
    id: sntp_time
    timezone: Asia/Taipei
    on_time:
      - cron: '* * * * * *'
        then:
          lambda: |-
            char buff[10] = "-";
            auto time = id(sntp_time).now();
            if (time.is_valid())
              sprintf(buff, "%02d:%02d:%02d", time.hour, time.minute, time.second);
            id(local_time).set_value(std::string(buff));

number:
  - platform: template   # 定義活躍的entity螢幕亮度參數，與 enabled: return true; 搭配使用
    id: screen_brightness
    name: Active screen brightness
    min_value: 0
    max_value: 100
    step: 5
    initial_value: 75
    restore_value: true
    set_action:
      - lambda: |-
          if (!id(deck).get_inactivity())
            id(device).set_brightness(x);

  - platform: template ## 定義不活躍的entity螢幕亮度參數，見 (不活躍的小部件)
    id: inactive_screen_brightness
    name: Inactive screen brightness
    min_value: 0
    max_value: 100
    step: 5
    initial_value: 20
    restore_value: true
    set_action:
      - lambda: |-
          if (id(deck).get_inactivity())
            id(device).set_brightness(x);
    
hd_device_wt32s3_86s:
  id: device
  brightness: 75  #默認螢幕亮度

ha_deck:
  id: deck
  main_screen: ${SCREEN_MAIN}  # 設備參數，**沒事別動**
  inactivity:
    period: 60 # seconds 60秒回主畫面
    blank_screen: true  #休眠黑畫面有效
  on_inactivity_change:
    lambda:  |-
      if (x) {
        id(device).set_brightness(id(inactive_screen_brightness).state);
      } else {
        id(device).set_brightness(id(screen_brightness).state);
      }
  screens:
    ########################################## 以下可修改增減
    #
    #     主畫面 
    #
    #########################################
    - name: ${SCREEN_MAIN} 
      widgets:
        - type: value-card  #  1-1 (時鐘)
          id: local_time
          position: 8, 8
          text: "Taiwan"
          enabled: return true;

        - type: value-card  # 1-2 (溫度)
          position: 126, 8  
          text: "°C"
          icon: 󰔏
          enabled: return true;
          # 把客廳的溫度轉為數字形式顯示出來
          value: |-
            char buff[10] = "-";
            sprintf(buff, "%.1f", id(living_temperature).state);
            return std::string(buff);

        - type: value-card  # 1-3+1-4 (天氣預報)
          position:  244, 8
          dimensions: 228x110          
          text: "Weather Forecast"
          enabled: return true;
          # 把天氣預報的文字顯示出來
          value: |-
             return id(weather_state).state;  

        - type: button
          position: 8, 127 # 2-1 (參數調整)
          text: "Favorite"
          icon: 󰋑
          enabled: return true;
          on_click:
            lambda: id(deck).switch_screen("$SCREEN_FAVORITE");  # 按下跳到favorite頁面

        - type: button
          # id: floors
          position: 126, 127 # 2-2 (進入房間主頁)
          text: "Rooms"
          icon: 󰠡
          enabled: return true;
          on_click:
            lambda: id(deck).switch_screen("$SCREEN_ROOMS");

        - type: button
          position: 244, 127  #2-3 (一般開關)
          text: "Study"
          icon: 󰟩
          toggle: true  #打開反饋按鈕亮琥珀色底
          enabled: return true;
          # 反饋的依據參考 study_relay_state 這個id的狀態
          checked: |-
            if(id(study_relay_state).state == "on") { return 1; }
            else { return 0; }
          on_turn_on:
            - homeassistant.service:  # 執行HA的 Service
                service: switch.turn_on  # SWITCH Service 
                data:
                  entity_id: switch.hp_print_relay_device_relay # HA裡面的entity
          on_turn_off:
            - homeassistant.service:
                service: switch.turn_off
                data:
                  entity_id: switch.hp_print_relay_device_relay

        - type: button
          position:  362, 127 # 2-3 (可調光電燈ON/OFF)
          text: Livingroom
          icon: 󱁑
          toggle: true
          enabled: return true;
          checked: |-
            if(id(liv_light_state).state == "on") { return 1; }
            else { return 0; }
          on_turn_on:
            - homeassistant.service:
                service: light.turn_on
                data:
                  entity_id: light.wled
          on_turn_off:
            - homeassistant.service:
                service: light.turn_off
                data:
                  entity_id: light.wled

        - type: button
          position: 8, 246  #2-4 (可調速風扇ON/OFF)
          text: "Bedroom"
          icon: 󰈐
          toggle: true
          enabled: return true;
          checked: |-
            if(id(bed_fan_state).state == "on") { return 1; }
            else { return 0; }
          on_turn_on:
            - homeassistant.service:
                service: fan.turn_on
                data:
                  entity_id: fan.zhimi_fa1_b621_fan
          on_turn_off:
            - homeassistant.service:
                service: fan.turn_off
                data:
                  entity_id: fan.zhimi_fa1_b621_fan

        - type: button
          position: 126, 246  #3-1 (Media Play)
          text: "Media Play"
          icon: 󰄙
          enabled: return true;
          on_click:
            lambda: |-
                id(deck).switch_screen("$SCREEN_MEDIA");

        - type: button
          position: 244, 246  #3-2 (A/C 空調)
          text: "Livingroom"
          icon: 󰀛
          enabled: return true;
          on_click:
            lambda: |-
                id(deck).switch_screen("$SCREEN_LIVCLIMATE");

        - type: button
          position: 362, 246  #3-3 (curtains 窗簾)
          text: "Livingroom"
          icon: 󱡆
          enabled: return true;
          on_click:
            lambda: |-
                id(deck).switch_screen("$SCREEN_CURTAIN");

        - type: button
          position: 8, 365  #4-1 (觸發睡覺場景)
          text: "Sleep Mode"
          icon: 󰋣
          enabled: return true;
          on_click:
            - homeassistant.service:
                service: scene.turn_on
                data:
                  entity_id: scene.sleep_mode

        - type: button
          position: 126, 365  #4-2 (觸發起床腳本)
          text: "Wake Up"
          icon: 󰀠
          enabled: return true;
          on_click:
            - homeassistant.service:
                service: script.toggle
                data:
                  entity_id: script.unknown

        - type: button
          position: 244, 365  #4-3 (不活躍的小部件)
          text: "Wish"
          icon: 󰐔
          # enabled: return true;

        - type: button
          position: 362, 365 #4-4座標(one touch)
          text: "One Touch"
          icon: 󰄰
          toggle: true
          enabled: return true;
          checked: |-
            if(id(livingroom_one_touch).state == true ) { return 1; }
            else { return 0; }
          on_turn_on:
            - switch.turn_on: livingroom_one_touch
          on_turn_off:
            - switch.turn_off: livingroom_one_touch
    #################################################
    #
    #     房間畫面有全部(16個)按鍵座標參數
    #
    #################################################
    - name: ${SCREEN_ROOMS} #房間畫面
      widgets:
        - type: button
          position: 8, 8  #1-1 座標 返回主畫面
          icon: 󰁍
          enabled: |-
            return true;
          on_click:
            then:
            - lambda: |-
                id(deck).switch_screen("$SCREEN_MAIN");

        - type: button
          position: 126, 8  #1-2座標
          text: "LivingRoom"
          icon: 󰒹
          # enabled: return true;

        - type: button
          position: 244, 8  #1-3座標
          text: "MainRoom"
          icon: 󰿒
          # enabled: return true;

        - type: button
          position: 362, 8  #1-4座標
          text: "KidsRoom"
          icon: 󰢠
          # enabled: return true;

        - type: button
          position: 8, 127   #2-1座標
          text: "Kitchen"
          icon: 󰩰
          enabled: |-
            return true;
          on_click:
            then:
            - lambda: |-
                id(deck).switch_screen("$SCREEN_KITCHEN");

    ################################################
    #
    #     KITCHEN 設備畫面
    #
    ###############################################     
    - name: ${SCREEN_KITCHEN} #房間畫面
      widgets:
        - type: button
          position: 8, 8  #1-1 座標 返回主畫面
          icon: 󰁍
          enabled: |-
            return true;
          on_click:
            then:
            - lambda: |-
                id(deck).switch_screen("$SCREEN_ROOMS"); 

        - type: button
          position: 126, 8  #1-2 咖啡機
          text: "Coffee"
          icon: 󱂟
          # enabled: return true;

    ##########################################
    #
    #     設定默認畫面
    #
    #########################################                                
    - name: ${SCREEN_FAVORITE}  #調整參數畫面
      widgets:
        - type: button   #返回主畫面
          position: 0, 0
          dimensions: 48x480     
          icon: 󰅁
          enabled: return true;
          on_click:
            - lambda: id(deck).switch_screen("$SCREEN_MAIN");        

######################################
#
#   用於虛擬switch，以及與HA同步的相關entity id
# 
#####################################
text_sensor:  #"文字" 類用text_sensor 開關的on/off 也算是
  - platform: wifi_info
    ip_address:
      name: "IP"      
      icon: "mdi:ip-outline"     
    mac_address:
      name: "MAC"
      icon: "mdi:lan"    

  - platform: homeassistant #取得HA書房一般電燈狀態
    id: study_relay_state
    entity_id: switch.hp_print_relay_device_relay   

  - platform: homeassistant #取得客廳電燈WLED
    id: liv_light_state
    entity_id: light.wled        

  - platform: homeassistant #取得臥室風扇狀態
    id: bed_fan_state
    entity_id: fan.zhimi_fa1_b621_fan    

  - platform: homeassistant  #取得天氣預報狀態
    id: weather_state
    entity_id: sensor.opencwb_forecast_condition

sensor:  #"數值" 類用 sensor
  - platform: homeassistant #取得客廳溫度數值
    id: living_temperature
    entity_id: sensor.livingroom_ikea_air_quality_livingroom_temperatur

switch: #開關 暴露在HA後期作自動化用
  - platform: template #one_touch
    name: "livingroom_one_touch"
    id: livingroom_one_touch
    optimistic: true  
  
